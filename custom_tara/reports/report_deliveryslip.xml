<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="report_delivery_inherit" inherit_id="stock.report_delivery_document">
        <xpath expr="//div[@class='page']" position="replace">
            <div class="page">
                <div class="row text-center" style="font-size: 18px; font-weight: bold; border:1px">
                    <div t-if="o.picking_type_id.code == 'outgoing'">Delivery Note (Surat Jalan)</div>
                    <div t-if="o.picking_type_id.code == 'incoming'">Receive Note (Penerimaan Barang)</div>
                    <div t-if="o.picking_type_id.code == 'internal'">Transfer Note (Transfer Antar Lokasi)</div>
                    <div t-field="o.name"></div>
                </div>
                <div class="col-xs-6 pull-left">
                    <div>
                        <span><strong>Kepada Yth:</strong></span>
                    </div>
                    <div t-if="o.move_lines and o.move_lines[0].partner_id" name="partner_header">
                        <div t-field="o.move_lines[0].partner_id"
                            t-options='{"widget": "contact", "fields": ["address", "name", "phone", "fax"], "no_marker": True}'/>
                    </div>
                    <div t-if="not (o.move_lines and o.move_lines[0].partner_id) and o.partner_id" name="partner_header">
                        <div t-field="o.partner_id"
                            t-options='{"widget": "contact", "fields": ["address", "name", "phone", "fax"], "no_marker": True}'/>
                    </div>
                </div>
                <div class="col-xs-5 col-xs-offset-1" t-if="o.picking_type_id.code == 'outgoing'">
                    <div>
                        <span><strong>Dikirim ke:</strong></span>
                    </div>
                    <div t-if="o.move_lines and o.move_lines[0].partner_id" name="partner_header">
                        <div t-field="o.move_lines[0].partner_id" />
                        <div t-field="o.move_lines[0].partner_id.delivery_street" />
                        <div t-field="o.move_lines[0].partner_id.delivery_street2" />
                        <span> 
                            <span t-field="o.move_lines[0].partner_id.delivery_city" /> - 
                            <span t-field="o.move_lines[0].partner_id.delivery_state_id" /> -
                            <span t-field="o.move_lines[0].partner_id.delivery_zip" />
                        </span>
                    </div>
                </div>

                <table class="table table-condensed mt16" t-if="o.picking_type_id.code == 'outgoing'">
                    <thead>
                        <tr>
                            <th><strong>Tanggal Kirim</strong></th>
                            <th><strong>Sales Order Ref</strong></th>
                            <th><strong>Tanggal Order</strong></th>
                            <th><strong>Customer PO. No</strong></th>
                            <th><strong>Consignment Note No</strong></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span t-field="o.date_done"/></td>
                            <td><span t-field="o.order_id"/></td>
                            <td><span t-field="o.order_id.date_order"/></td>
                            <td><span t-field="o.order_id.client_order_ref"/></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
                
                <table class="table table-condensed mt48" t-if="o.pack_operation_ids">
                    <t t-set="has_serial_number" t-value="o.pack_operation_ids.filtered('pack_lot_ids')" groups="stock.group_production_lot"/>
                    <thead>
                        <tr>
                            <th><strong>Kode Barang</strong></th>
                            <th><strong>Nama Barang</strong></th>
                            <th name="lot_serial" t-if="has_serial_number">
                                <span class="pull-left">Lot/Serial Number</span>
                            </th>
                            <th class="text-center"><strong>Jumlah Pengiriman</strong></th>
                            <th class="text-center"><strong>Jumlah Pieces</strong></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="o.pack_operation_ids" t-as="pack_operation">
                            <td>
                                <span t-field="pack_operation.product_id.default_code"/>
                            </td>
                            <td>
                                <span t-field="pack_operation.product_id.name"/>
                                <t t-if="not pack_operation.product_id and pack_operation.package_id">
                                    <span  t-field="pack_operation.package_id"/>
                                </t>
                            </td>
                            
                            <t t-if="has_serial_number">
                                <td t-if="pack_operation.pack_lot_ids">
                                    <table class="table table-condensed" t-if="pack_operation.pack_lot_ids">
                                        <tr t-foreach="pack_operation.pack_lot_ids" t-as="packlot">
                                            <td>
                                                <span t-field="packlot.lot_id"/>
                                                <t t-if="not packlot.lot_id">
                                                    <span t-field="packlot.lot_name"/>
                                                </t>
                                            </td>
                                            <td name="lot_qty">
                                                <span t-field="packlot.qty"/>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td t-if="not pack_operation.pack_lot_ids"/>
                            </t>

                            <td class="text-center">
                                <span t-foreach="pack_operation.linked_move_operation_ids" t-as="linked_move">
                                    <span t-field="linked_move.move_id.product_uom_qty"></span>
                                    <span t-field="linked_move.move_id.product_uom"></span>
                                </span>
                            </td>

                            <td class="text-center">
                                <span t-field="pack_operation.qty_done"></span>
                                <span t-field="pack_operation.product_uom_id"></span>
                            </td>
                        </tr>
                    </tbody>    
                </table>
            </div>

            <div class="footer">
                <div class="text-center">
                    <table style="width: 100%">
                        <thead>
                            <th style="border:1px solid black; width:20%">Diterima Oleh</th>
                            <th style="border:1px solid black; width:20%">Dikirim Oleh</th>
                            <th style="border-top:1px solid black; border-right:1px solid black;">Hormat Kami</th>
                        </thead>
                        <tbody>
                            <td style="border:1px solid black; height: 65px"/>
                            <td style="border:1px solid black; height: 65px"/>
                            <td style="border-bottom:1px solid black; border-right:1px solid black; height: 65px"/>
                        </tbody>
                    </table>
                    <div class="col-xs-6 pull-left text-left">
                        <span> 
                            <span>Delivery Note / Surat Jalan:</span>
                            <span t-field="o.name"/>
                        </span>
                    </div>
                    <div class="col-xs-5 col-xs-offset-1 text-right">
                        <span>
                            <span>Page:</span>
                            <span class="page"></span>
                            <span>/ </span>
                            <span class="topage"></span>
                        </span>
                    </div>
                </div>
            </div>
        </xpath>
    </template>
</odoo>
